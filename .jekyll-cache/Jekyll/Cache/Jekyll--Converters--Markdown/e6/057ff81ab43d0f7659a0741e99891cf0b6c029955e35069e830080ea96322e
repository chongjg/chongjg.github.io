I"ì%<p><strong>(æŒç»­æ›´æ–°ä¸­â€¦)</strong></p>

<h2 id="telea">TELEA</h2>

<ul>
  <li>
    <p><strong><a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.98.5505&amp;rep=rep1&amp;type=pdf">åŸè®ºæ–‡ä¸‹è½½</a>ï¼›<a href="https://github.com/chongjg/Image-Inpainting/blob/master/paper/An%20Image%20Inpainting%20Technique%20Based%20on%20the%20Fast%20Marching%20Method.pdf">å¸¦ç¬”è®°è®ºæ–‡ä¸‹è½½</a></strong></p>
  </li>
  <li>
    <p>è¿™ä¸ªç®—æ³•æ˜¯opencvè‡ªå¸¦çš„å›¾åƒä¿®å¤ç®—æ³•ï¼Œç›´æ¥è¯´ç®—æ³•çš„æµç¨‹å§ï¼š</p>
  </li>
</ul>

<h4 id="1åŒºåŸŸåˆ’åˆ†">1.åŒºåŸŸåˆ’åˆ†</h4>

<ul>
  <li>æŠŠæ¯ä¸ªåƒç´ æ ‡è®°ä¸º<strong>KNOWNã€BANDã€INSIDE</strong>ä¸‰ç§</li>
</ul>

<ol>
  <li>
    <p><strong>INSIDE</strong>ï¼šå¾…ä¿®å¤çš„åƒç´ ï¼Œè¡¨ç¤ºæ˜¯å¾…ä¿®å¤çš„å—çš„å†…éƒ¨åƒç´ ã€‚</p>
  </li>
  <li>
    <p><strong>BAND</strong>ï¼šä¸å¾…ä¿®å¤çš„åƒç´ ç›¸é‚»çš„å·²çŸ¥åƒç´ ï¼Œè¡¨ç¤ºå—çš„è¾¹ç•Œã€‚</p>
  </li>
  <li>
    <p><strong>KNOWN</strong>ï¼šå…¶ä»–å·²çŸ¥åƒç´ ã€‚</p>
  </li>
</ol>

<p><img src="https://raw.githubusercontent.com/chongjg/chongjg.github.io/master/img/Image-Inpainting/inpainting-principle.png" alt="" /></p>

<ul>
  <li>å¦‚ä¸Šå›¾(a)æ‰€ç¤ºï¼Œåœˆå†…æ˜¯å¾…ä¿®å¤éƒ¨åˆ†<strong>INSIDE</strong>ï¼Œåœˆå¤–æ˜¯å·²çŸ¥éƒ¨åˆ†<strong>KNOWN</strong>ï¼Œåœˆå°±æ˜¯<strong>BAND</strong>ã€‚</li>
</ul>

<h4 id="2ä¿®å¤å•ä¸ªåƒç´ ">2.ä¿®å¤å•ä¸ªåƒç´ </h4>

<ul>
  <li>
    <p>è€ƒè™‘ä¿®å¤ä¸€ä¸ªä¸<strong>BAND</strong>ç›¸é‚»çš„æœªçŸ¥ç‚¹<script type="math/tex">p</script>ï¼Œå¦‚ä¸Šå›¾(b)æ‰€ç¤ºï¼Œå¯¹äºé™„è¿‘æŸä¸€ä¸ªå·²çŸ¥(<strong>BANDå’ŒKNOWN</strong>)çš„ç‚¹<script type="math/tex">q</script>ï¼Œå¯ä»¥é€šè¿‡<script type="math/tex">p=I(q)+\nabla I(q)*(p-q)</script>æ¥é¢„æµ‹å¾…ä¿®å¤ç‚¹<script type="math/tex">p</script>ã€‚</p>
  </li>
  <li>
    <p>åŸºäºè¿™ä¸ªæ€è·¯ï¼Œå¯ä»¥ä»¥<script type="math/tex">p</script>ä¸ºåœ†å¿ƒ<script type="math/tex">\varepsilon</script>ä¸ºåŠå¾„ç”»ä¸€ä¸ªåœ†ï¼Œå¦‚ä¸Šå›¾(a)ï¼Œåœ†å†…å·²çŸ¥åƒç´ é›†åˆè®°ä¸º<script type="math/tex">B_\varepsilon(p)</script>ï¼Œå¯¹äºä»»æ„<script type="math/tex">q\in B_\varepsilon</script>éƒ½ä¼šå¯¹<script type="math/tex">I(p)</script>æœ‰ä¸€ä¸ªé¢„æµ‹å€¼ï¼Œå¯¹æ¯ä¸€ä¸ªé¢„æµ‹èµ‹äºˆåˆé€‚çš„æƒå€¼<script type="math/tex">w(p,q)</script>ï¼Œæœ€åç”¨å½’ä¸€åŒ–åŠ æƒé¢„æµ‹ç»“æœä½œä¸ºåƒç´ ä¿®å¤çš„å€¼ï¼Œä¸”æ­¤åå°†åƒç´ è§†ä¸ºå·²çŸ¥ï¼Œç»§ç»­ä¿®å¤ä¸‹ä¸€ä¸ªåƒç´ ã€‚</p>
  </li>
</ul>

<script type="math/tex; mode=display">I(p)=\frac{\underset{q\in B_\varepsilon(p)}{\sum}w(p,q)[I(q)+\nabla I(q)(p-q)]}{\underset{q\in B_\varepsilon(p)}{\sum} w(p,q)}</script>

<h4 id="3ä¿®å¤é¡ºåº">3.ä¿®å¤é¡ºåº</h4>

<ul>
  <li>
    <p>å‰é¢å·²ç»æåˆ°æ˜¯ä¸€ä¸ªä¸€ä¸ªåƒç´ ä¿®å¤ï¼Œè€Œé¡ºåºåˆ™æ˜¯æ²¿ç€è¾¹ç•Œå¾€ä¸­å¿ƒè”“å»¶æŒ¨ä¸ªä¿®å¤ã€‚</p>
  </li>
  <li>
    <p>ä»¤<script type="math/tex">T(p)</script>è¡¨ç¤ºåƒç´ <script type="math/tex">p</script>ç¦»<strong>BAND</strong>çš„æœ€è¿‘è·ç¦»ï¼Œå°±å¯ä»¥é€šè¿‡<script type="math/tex">T(p)</script>ä»å°åˆ°å¤§ä¿®å¤æœªçŸ¥çš„åƒç´ ã€‚ï¼ˆ<script type="math/tex">T</script>ç›¸ç­‰çš„ç‚¹è¿èµ·æ¥å¯çœ‹åšç­‰é«˜çº¿ï¼‰</p>
  </li>
  <li>
    <p><script type="math/tex">T(p)</script>é€šè¿‡æ±‚è§£ä¸‹é¢æ–¹ç¨‹å¾—åˆ°ï¼Œå®é™…ä¸Šä¸æ˜¯ä¸¥æ ¼çš„è·ç¦»ã€‚</p>
  </li>
</ul>

<script type="math/tex; mode=display">\vert\nabla T\vert=1,\quad with\; T=0\; in\; BAND</script>

<ul>
  <li>æ•°å€¼æ±‚è§£æ–¹æ³•å¦‚ä¸‹ï¼š</li>
</ul>

<script type="math/tex; mode=display">\max(D^{-x}T,-D^{+x}T,0)^2+\max(D^{-y}T,-D^{+y}T,0)^2=1</script>

<ul>
  <li>å…¶ä¸­:(<script type="math/tex">D^{\pm y}</script>ç±»ä¼¼)</li>
</ul>

<script type="math/tex; mode=display">D^{-x}T(i,j)=T(i,j)-T(i-1,j)</script>

<script type="math/tex; mode=display">D^{+x}T(i,j)=T(i+1,j)-T(i,j)</script>

<ul>
  <li>ä»¤<script type="math/tex">T_0=T(i,j),T_1=T(i+\Delta i,j),T_2=T(i,j+\Delta j)</script>ï¼Œåˆ™æœ‰ï¼š</li>
</ul>

<script type="math/tex; mode=display">% <![CDATA[
\begin{aligned}
(T_0-T_1)^2+(T_0-T_2)^2=&1\\
2T_0^2-2(T_1+T_2)T_0+T_1^2+T_2^2-1=&0\\
\end{aligned} %]]></script>

<ul>
  <li>è§£ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹å¾—ï¼š</li>
</ul>

<script type="math/tex; mode=display">T_0=\frac{(T_1+T_2)\pm\sqrt{(2-(T_1-T_2)^2)}}{2}</script>

<ul>
  <li>
    <p>é€šè¿‡ä¸Šé¢çš„æ›´æ–°è·ç¦»æ–¹æ³•ï¼Œå†ç»“åˆæœ€çŸ­è·¯ç®—æ³•SPFAå¯ä»¥å¾—åˆ°æ‰€æœ‰<script type="math/tex">T</script>å€¼ï¼ˆè¿™ç§ç»“åˆå¯èƒ½ä¸å¤ªä¸¥è°¨ï¼Œä½†æ˜¯æ— ä¼¤å¤§é›…ï¼‰</p>
  </li>
  <li>
    <p>æ­¤æ—¶å¯¹äº<strong>KNOWN</strong>ç±»å‹çš„ç‚¹å°† <script type="math/tex">T</script> å–åï¼Œè¿™æ ·é€šè¿‡ <script type="math/tex">T</script> ç›¸å‡å°±æœ‰ç­‰é«˜çº¿å·®å€¼çš„æ„ä¹‰äº†ã€‚</p>
  </li>
  <li>
    <p>æœ€åä½¿ç”¨<script type="math/tex">3\times 3\; tent\; filter</script>å¤„ç† <script type="math/tex">T</script>ï¼Œåœ¨ç½‘ä¸ŠæŸ¥äº†ä¸€ä¸‹è¿™é‡Œçš„<script type="math/tex">tent\; filter</script>å¯èƒ½æ˜¯æŒ‡å¦‚ä¸‹å‡½æ•°ï¼š</p>
  </li>
</ul>

<script type="math/tex; mode=display">f(x)=\left\{
\begin{aligned}
1-\vert x\vert, \vert x\vert\leq 1\\
0, \vert x\vert >1
\end{aligned}
\right.</script>

<ul>
  <li>æ‰©å±•åˆ°äºŒç»´æˆ‘åœ¨ä»£ç é‡Œç›´æ¥ç”¨çš„3*3é«˜æ–¯æ ¸ã€‚</li>
</ul>

<h4 id="4æƒå€¼è®¾ç½®">4.æƒå€¼è®¾ç½®</h4>

<ul>
  <li>è€ƒè™‘å¾…ä¿®å¤ç‚¹<script type="math/tex">p</script>åŠå·²çŸ¥ç‚¹<script type="math/tex">q\in B_\varepsilon(p)</script></li>
</ul>

<p>1.æ–¹å‘éƒ¨åˆ†ï¼š<script type="math/tex">\nabla T</script>çš„æ–¹å‘å¦‚æœå’Œ <script type="math/tex">(p-q)</script> çš„æ–¹å‘ä¸€è‡´ï¼Œåˆ™ç»™äºˆæ›´å¤§æƒé‡ï¼Œè®¾ç½®ä¸ºä¸¤è€…çš„ç‚¹ç§¯ã€‚</p>

<script type="math/tex; mode=display">dir(p,q)=\frac{p-q}{\parallel p-q\parallel}\cdot \nabla T</script>

<p>2.è·ç¦»éƒ¨åˆ†ï¼š<script type="math/tex">p</script> å’Œ <script type="math/tex">q</script> è·ç¦»è¶Šè¿œï¼Œæƒé‡è¶Šå°ï¼Œè®¾ç½®ä¸ºè·ç¦»å¹³æ–¹çš„å€’æ•°</p>

<script type="math/tex; mode=display">dst(p,q)=\frac{d_0^2}{\parallel p-q\parallel^2}</script>

<p>3.ç­‰é«˜çº¿éƒ¨åˆ†ï¼š<script type="math/tex">T(p)</script>å’Œ<script type="math/tex">T(q)</script>å·®è·è¶Šå¤§ï¼Œæƒé‡è¶Šå°</p>

<script type="math/tex; mode=display">lev(p,q)=\frac{T_0}{1+\vert T(p)-T(q)\vert}</script>

<ul>
  <li>æƒé‡åˆ™è®¾ç½®ä¸ºä¸‰è€…ä¹˜ç§¯</li>
</ul>

<script type="math/tex; mode=display">w(p,q)=dir(p,q)*dst(p,q)*lev(p,q)</script>

<h4 id="å®éªŒç»“æœåŠä»£ç ">å®éªŒç»“æœåŠä»£ç </h4>

<ul>
  <li>
    <p>ï¼ˆä¸€å¼€å§‹æƒ³ç€ç†Ÿæ‚‰C++çš„ä¼˜å…ˆé˜Ÿåˆ—å°±ç”¨C++å®ç°ï¼Œç°åœ¨æƒ³æƒ³çœŸæ˜¯è„‘æŠ½ï¼Œå†™å®ŒåŠ è°ƒè¯•èŠ±äº†å¤§æ¦‚åä¸ªå°æ—¶ï¼ŒMatlabå®ƒä¸é¦™å—</p>
  </li>
  <li>
    <p>è‡ªå·±å†™çš„æ•ˆæœå’Œopencvè‡ªå¸¦å‡½æ•°ç›¸æ¯”æœ‰ä¸€å®šçš„å·®è·ï¼Œå¯èƒ½ä»£ç è¿˜æœ‰å°bugæˆ–è€…å…·ä½“å®ç°å’Œä½œè€…è¿˜æœ‰ç‚¹å‡ºå…¥ï¼Œä½†æ˜¯å·²ç»ä¸æƒ³æŠ˜è…¾äº†ã€‚</p>
  </li>
  <li>
    <p>ä»å·¦åˆ°å³åˆ†åˆ«æ˜¯åŸå›¾ï¼Œopencvç»“æœï¼Œæˆ‘è‡ªå·±å†™çš„ä»£ç ç»“æœã€‚</p>
  </li>
</ul>

<p><img src="https://raw.githubusercontent.com/chongjg/chongjg.github.io/master/img/Image-Inpainting/TELEA-result.jpg" alt="" /></p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include "opencv2/imgproc.hpp"
#include "opencv2/highgui.hpp"
#include "opencv2/photo.hpp"
</span>
<span class="cp">#include&lt;cmath&gt;
#include&lt;queue&gt;
#include&lt;cstdio&gt;
#include&lt;cstring&gt;
#include&lt;cstdlib&gt;
#include&lt;iostream&gt;
#include&lt;algorithm&gt;
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>

<span class="cp">#define KNOWN 0
#define BAND 1
#define INSIDE 2
</span>
<span class="cp">#define epsilon 6
</span>
<span class="cp">#define X first
#define Y second
</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">To</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">}};</span>

<span class="kt">int</span> <span class="n">B</span><span class="p">[</span><span class="n">epsilon</span> <span class="o">*</span> <span class="n">epsilon</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">Btop</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

<span class="n">string</span> <span class="n">img_path</span> <span class="o">=</span> <span class="s">"/home/chongjg/Desktop/image-inpainting/image/"</span><span class="p">;</span>
<span class="n">string</span> <span class="n">output_path</span> <span class="o">=</span> <span class="s">"/home/chongjg/Desktop/image-inpainting/output/"</span><span class="p">;</span>

<span class="n">Mat</span> <span class="n">img</span><span class="p">,</span> <span class="n">mask</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">;</span>

<span class="kt">char</span><span class="o">*</span> <span class="n">f</span><span class="p">;</span>
<span class="kt">float</span><span class="o">*</span> <span class="n">T</span><span class="p">;</span>
<span class="kt">bool</span><span class="o">*</span> <span class="n">vis</span><span class="p">;</span>

<span class="kt">bool</span> <span class="nf">Check</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="kt">int</span> <span class="n">j</span><span class="p">){</span> <span class="k">return</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span> <span class="o">&amp;&amp;</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">j</span> <span class="o">&amp;&amp;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">M</span><span class="p">;</span> <span class="p">}</span>

<span class="kt">void</span> <span class="nf">create_mask</span><span class="p">(</span><span class="n">Mat</span> <span class="o">&amp;</span><span class="n">img</span><span class="p">,</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">img_path</span><span class="p">){</span>
    <span class="kt">int</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">interval</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">Mat</span><span class="p">(</span><span class="n">img</span><span class="p">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">img</span><span class="p">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">CV_8UC1</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">img</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">img</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span> <span class="n">j</span> <span class="o">++</span><span class="p">)</span>
            <span class="n">mask</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="p">(((</span><span class="n">i</span> <span class="o">/</span> <span class="n">width</span><span class="p">)</span> <span class="o">%</span> <span class="n">interval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="n">j</span> <span class="o">/</span> <span class="n">width</span><span class="p">)</span> <span class="o">%</span> <span class="n">interval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="o">*</span> <span class="mi">255</span><span class="p">;</span>
    <span class="n">imwrite</span><span class="p">(</span><span class="n">img_path</span> <span class="o">+</span> <span class="s">"mask.jpg"</span><span class="p">,</span> <span class="n">mask</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">BandPixel</span><span class="p">{</span>

    <span class="kt">float</span> <span class="n">T</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>

    <span class="n">BandPixel</span><span class="p">(){}</span>
    <span class="n">BandPixel</span><span class="p">(</span><span class="kt">float</span> <span class="n">T</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="o">:</span> <span class="n">T</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">x</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="p">{}</span>

<span class="p">};</span>

<span class="kt">bool</span> <span class="k">operator</span> <span class="o">&lt;</span> <span class="p">(</span><span class="k">const</span> <span class="n">BandPixel</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">BandPixel</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">){</span><span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">T</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">.</span><span class="n">T</span><span class="p">;}</span>

<span class="kt">float</span> <span class="nf">solEqua</span><span class="p">(</span><span class="kt">int</span> <span class="n">i1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">j1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">j2</span><span class="p">){</span>
    <span class="k">static</span> <span class="kt">float</span> <span class="n">r</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">re</span> <span class="o">=</span> <span class="mf">1e6</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">Check</span><span class="p">(</span><span class="n">i1</span><span class="p">,</span> <span class="n">j1</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">Check</span><span class="p">(</span><span class="n">i2</span><span class="p">,</span> <span class="n">j2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">re</span><span class="p">;</span>
    <span class="n">T1</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="n">i1</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">j1</span><span class="p">],</span> <span class="n">T2</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="n">i2</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">j2</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="n">T1</span> <span class="o">&lt;</span> <span class="mf">1e6</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">T2</span> <span class="o">&lt;</span> <span class="mf">1e6</span><span class="p">){</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">T1</span> <span class="o">-</span> <span class="n">T2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">T1</span> <span class="o">-</span> <span class="n">T2</span><span class="p">));</span>
            <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">T1</span> <span class="o">+</span> <span class="n">T2</span> <span class="o">-</span> <span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="n">s</span> <span class="o">&gt;=</span> <span class="n">max</span><span class="p">(</span><span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">))</span>
                <span class="n">re</span> <span class="o">=</span> <span class="n">s</span><span class="p">;</span>
            <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">r</span> <span class="o">&gt;=</span> <span class="n">max</span><span class="p">(</span><span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">))</span>
                <span class="n">re</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">r</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
            <span class="n">re</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">T1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">T2</span> <span class="o">&lt;</span> <span class="mf">1e6</span><span class="p">)</span>
        <span class="n">re</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">T2</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">re</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">TentFilter</span><span class="p">(){</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">kernal</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">};</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">[</span><span class="mi">9</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">}</span> <span class="p">};</span>
    <span class="kt">float</span><span class="o">*</span> <span class="n">tmp</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">float</span><span class="p">[</span><span class="n">N</span> <span class="o">*</span> <span class="n">M</span><span class="p">];</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">N</span> <span class="o">*</span> <span class="n">M</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">w</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">M</span><span class="p">;</span> <span class="n">j</span> <span class="o">++</span><span class="p">){</span>
            <span class="n">w</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">;</span> <span class="n">k</span> <span class="o">++</span><span class="p">){</span>
                <span class="n">ii</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">idx</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
                <span class="n">jj</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="n">idx</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
                <span class="k">if</span><span class="p">(</span><span class="n">Check</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">))</span>
                    <span class="n">w</span> <span class="o">+=</span> <span class="n">kernal</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">tmp</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">kernal</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="n">ii</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">jj</span><span class="p">];</span>
            <span class="p">}</span>
            <span class="n">tmp</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">/=</span> <span class="n">w</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span> <span class="o">*</span> <span class="n">M</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span>
        <span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="p">}</span>

<span class="n">priority_queue</span><span class="o">&lt;</span><span class="n">BandPixel</span><span class="o">&gt;</span> <span class="n">NarrowBand</span><span class="p">;</span>
<span class="n">queue</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">ToBeInpainted</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">Init</span><span class="p">(){</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
    
    <span class="c1">//initiate B</span>

    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="n">epsilon</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">epsilon</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span>
        <span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="o">-</span><span class="n">epsilon</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">epsilon</span><span class="p">;</span> <span class="n">j</span> <span class="o">++</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">epsilon</span> <span class="o">*</span> <span class="n">epsilon</span><span class="p">){</span>
                <span class="n">Btop</span> <span class="o">++</span><span class="p">;</span>
                <span class="n">B</span><span class="p">[</span><span class="n">Btop</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
                <span class="n">B</span><span class="p">[</span><span class="n">Btop</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span><span class="p">;</span>
            <span class="p">}</span>

    <span class="c1">// input image &amp; mask</span>
    
    <span class="n">img</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="n">img_path</span> <span class="o">+</span> <span class="s">"test.jpg"</span><span class="p">);</span>
    <span class="n">create_mask</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">img_path</span><span class="p">);</span>

    <span class="n">N</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span>

    <span class="c1">// initiate f</span>
    
    <span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">N</span> <span class="o">*</span> <span class="n">M</span><span class="p">];</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">KNOWN</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">)</span> <span class="o">*</span> <span class="n">N</span> <span class="o">*</span> <span class="n">M</span><span class="p">);</span>

    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span>
        <span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">M</span><span class="p">;</span> <span class="n">j</span> <span class="o">++</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="n">mask</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="n">f</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">INSIDE</span><span class="p">;</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">k</span> <span class="o">++</span><span class="p">){</span>
                <span class="kt">int</span> <span class="n">ii</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">To</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">jj</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="n">To</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
                <span class="k">if</span><span class="p">(</span><span class="n">Check</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">[</span><span class="n">ii</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">jj</span><span class="p">]</span> <span class="o">==</span> <span class="n">KNOWN</span><span class="p">)</span>
                    <span class="n">f</span><span class="p">[</span><span class="n">ii</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">BAND</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="c1">// initiate NarrowBand &amp; T</span>

    <span class="n">BandPixel</span> <span class="n">t</span><span class="p">;</span>

    <span class="n">T</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">float</span><span class="p">[</span><span class="n">N</span> <span class="o">*</span> <span class="n">M</span><span class="p">];</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">N</span> <span class="o">*</span> <span class="n">M</span><span class="p">);</span>

    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span>
        <span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">M</span><span class="p">;</span> <span class="n">j</span> <span class="o">++</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">BAND</span><span class="p">)</span>
                <span class="n">NarrowBand</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">BandPixel</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">j</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">));</span>
            <span class="k">else</span>
                <span class="n">T</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e6</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="o">*</span><span class="n">vis</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">bool</span><span class="p">[</span><span class="n">N</span> <span class="o">*</span> <span class="n">M</span><span class="p">];</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="o">*</span> <span class="n">N</span> <span class="o">*</span> <span class="n">M</span><span class="p">);</span>

    <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">NarrowBand</span><span class="p">.</span><span class="n">empty</span><span class="p">()){</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">NarrowBand</span><span class="p">.</span><span class="n">top</span><span class="p">();</span>
        <span class="n">NarrowBand</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">j</span><span class="p">])</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="n">vis</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="n">ToBeInpainted</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">make_pair</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">));</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">k</span> <span class="o">++</span><span class="p">){</span>
            <span class="kt">int</span> <span class="n">ii</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">To</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">jj</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="n">To</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">Check</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">))</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="kt">float</span> <span class="n">tmpT</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">min</span><span class="p">(</span><span class="n">solEqua</span><span class="p">(</span><span class="n">ii</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
                                 <span class="n">solEqua</span><span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span>
                             <span class="n">min</span><span class="p">(</span><span class="n">solEqua</span><span class="p">(</span><span class="n">ii</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                                 <span class="n">solEqua</span><span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jj</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)));</span>
            <span class="n">tmpT</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">tmpT</span><span class="p">,</span> <span class="n">T</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">tmpT</span> <span class="o">&lt;</span> <span class="n">T</span><span class="p">[</span><span class="n">ii</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">jj</span><span class="p">]){</span>
                <span class="n">T</span><span class="p">[</span><span class="n">ii</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmpT</span><span class="p">;</span>
                <span class="n">NarrowBand</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">BandPixel</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">ii</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">jj</span><span class="p">],</span> <span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span>
        <span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">M</span><span class="p">;</span> <span class="n">j</span> <span class="o">++</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">KNOWN</span><span class="p">)</span>
                <span class="n">T</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    
    <span class="n">TentFilter</span><span class="p">();</span>
    
<span class="p">}</span>

<span class="n">pair</span><span class="o">&lt;</span><span class="kt">float</span><span class="p">,</span> <span class="kt">float</span><span class="o">&gt;</span> <span class="n">GradT</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">){</span>
    <span class="k">static</span> <span class="n">pair</span><span class="o">&lt;</span><span class="kt">float</span><span class="p">,</span> <span class="kt">float</span><span class="o">&gt;</span> <span class="n">re</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="n">N</span><span class="p">)</span>
        <span class="n">re</span><span class="p">.</span><span class="n">X</span> <span class="o">=</span> <span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">y</span><span class="p">]</span> <span class="o">-</span> <span class="n">T</span><span class="p">[(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">y</span><span class="p">]);</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">re</span><span class="p">.</span><span class="n">X</span> <span class="o">=</span> <span class="p">(</span><span class="n">T</span><span class="p">[(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">y</span><span class="p">]</span> <span class="o">-</span> <span class="n">T</span><span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">y</span><span class="p">]);</span>
    <span class="k">else</span>
        <span class="n">re</span><span class="p">.</span><span class="n">X</span> <span class="o">=</span> <span class="p">(</span><span class="n">T</span><span class="p">[(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">y</span><span class="p">]</span> <span class="o">-</span> <span class="n">T</span><span class="p">[(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">y</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="n">M</span><span class="p">)</span>
        <span class="n">re</span><span class="p">.</span><span class="n">Y</span> <span class="o">=</span> <span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">y</span><span class="p">]</span> <span class="o">-</span> <span class="n">T</span><span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]);</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">re</span><span class="p">.</span><span class="n">Y</span> <span class="o">=</span> <span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">T</span><span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">y</span><span class="p">]);</span>
    <span class="k">else</span>
        <span class="n">re</span><span class="p">.</span><span class="n">Y</span> <span class="o">=</span> <span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">T</span><span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">re</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">pair</span><span class="o">&lt;</span><span class="n">Vec3f</span><span class="p">,</span> <span class="n">Vec3f</span><span class="o">&gt;</span> <span class="n">GradI</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">){</span>
    <span class="k">static</span> <span class="n">pair</span><span class="o">&lt;</span><span class="n">Vec3f</span><span class="p">,</span> <span class="n">Vec3f</span><span class="o">&gt;</span> <span class="n">re</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">k</span> <span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="n">N</span> <span class="o">||</span> <span class="n">f</span><span class="p">[(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="n">INSIDE</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">f</span><span class="p">[(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="n">INSIDE</span><span class="p">)</span>
                <span class="n">re</span><span class="p">.</span><span class="n">X</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">else</span>
                <span class="n">re</span><span class="p">.</span><span class="n">X</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">img</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">img</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="n">k</span><span class="p">]);</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">f</span><span class="p">[(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="n">INSIDE</span><span class="p">)</span>
            <span class="n">re</span><span class="p">.</span><span class="n">X</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">img</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">img</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="n">k</span><span class="p">]);</span>
        <span class="k">else</span>
            <span class="n">re</span><span class="p">.</span><span class="n">X</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">img</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">img</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="n">k</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="n">M</span> <span class="o">||</span> <span class="n">f</span><span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">INSIDE</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">f</span><span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">INSIDE</span><span class="p">)</span>
                <span class="n">re</span><span class="p">.</span><span class="n">Y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">else</span>
                <span class="n">re</span><span class="p">.</span><span class="n">Y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">img</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">img</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)[</span><span class="n">k</span><span class="p">]);</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">f</span><span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">INSIDE</span><span class="p">)</span>
            <span class="n">re</span><span class="p">.</span><span class="n">Y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">img</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">img</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="n">k</span><span class="p">]);</span>
        <span class="k">else</span>
            <span class="n">re</span><span class="p">.</span><span class="n">Y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">img</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">img</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)[</span><span class="n">k</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">re</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">inpaint</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">){</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
    <span class="k">static</span> <span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">r</span><span class="p">;</span>
    <span class="k">static</span> <span class="n">pair</span><span class="o">&lt;</span><span class="kt">float</span><span class="p">,</span> <span class="kt">float</span><span class="o">&gt;</span> <span class="n">gradT</span><span class="p">;</span>
    <span class="k">static</span> <span class="n">pair</span><span class="o">&lt;</span><span class="n">Vec3f</span><span class="p">,</span> <span class="n">Vec3f</span><span class="o">&gt;</span> <span class="n">gradI</span><span class="p">;</span>
    <span class="k">static</span> <span class="kt">float</span> <span class="n">dir</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">lev</span><span class="p">,</span> <span class="n">w</span><span class="p">;</span>
    <span class="n">Vec3f</span> <span class="n">Ia</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">gradT</span> <span class="o">=</span> <span class="n">GradT</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="n">Btop</span><span class="p">;</span> <span class="n">t</span> <span class="o">++</span><span class="p">){</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">B</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">j</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">B</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">Check</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">||</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">INSIDE</span><span class="p">)</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">make_pair</span><span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">B</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">1</span><span class="p">]);</span>
        <span class="n">dir</span> <span class="o">=</span> <span class="n">fabs</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">gradT</span><span class="p">.</span><span class="n">X</span> <span class="o">+</span> <span class="n">r</span><span class="p">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">gradT</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">r</span><span class="p">.</span><span class="n">X</span> <span class="o">+</span> <span class="n">r</span><span class="p">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">r</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
        <span class="n">dst</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">r</span><span class="p">.</span><span class="n">X</span> <span class="o">+</span> <span class="n">r</span><span class="p">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">r</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
        <span class="n">lev</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">fabs</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">y</span><span class="p">]</span> <span class="o">-</span> <span class="n">T</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">j</span><span class="p">]));</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">dir</span> <span class="o">*</span> <span class="n">dst</span> <span class="o">*</span> <span class="n">lev</span><span class="p">;</span>

        <span class="n">gradI</span> <span class="o">=</span> <span class="n">GradI</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">);</span>
        <span class="n">Ia</span> <span class="o">+=</span> <span class="n">w</span> <span class="o">*</span> <span class="p">((</span><span class="n">Vec3f</span><span class="p">)</span><span class="n">img</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">gradI</span><span class="p">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">r</span><span class="p">.</span><span class="n">X</span> <span class="o">+</span> <span class="n">gradI</span><span class="p">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">r</span><span class="p">.</span><span class="n">Y</span><span class="p">));</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">w</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">img</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">Vec3b</span><span class="p">)(</span><span class="n">Ia</span> <span class="o">/</span> <span class="n">s</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">Solve</span><span class="p">(){</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
    <span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">;</span>
    
    <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">ToBeInpainted</span><span class="p">.</span><span class="n">empty</span><span class="p">()){</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">ToBeInpainted</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>
        <span class="n">ToBeInpainted</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span>
        <span class="n">f</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">KNOWN</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">k</span> <span class="o">++</span><span class="p">){</span>
            <span class="kt">int</span> <span class="n">ii</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">To</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">jj</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="n">To</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
            <span class="k">if</span><span class="p">(</span><span class="n">Check</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">[</span><span class="n">ii</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">jj</span><span class="p">]</span> <span class="o">==</span> <span class="n">INSIDE</span><span class="p">){</span>
                <span class="n">inpaint</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">);</span>
                <span class="n">f</span><span class="p">[</span><span class="n">ii</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">BAND</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>

    <span class="n">Init</span><span class="p">();</span>
    <span class="n">Solve</span><span class="p">();</span>

    <span class="n">imshow</span><span class="p">(</span><span class="s">"output"</span><span class="p">,</span> <span class="n">img</span><span class="p">);</span>
    <span class="n">imwrite</span><span class="p">(</span><span class="n">output_path</span> <span class="o">+</span> <span class="s">"inpainted.jpg"</span><span class="p">,</span> <span class="n">img</span><span class="p">);</span>
    <span class="n">waitKey</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="n">Mat</span> <span class="n">imgdst</span><span class="p">(</span><span class="n">img</span><span class="p">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">img</span><span class="p">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">CV_8UC3</span><span class="p">);</span>

    <span class="n">inpaint</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">imgdst</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">INPAINT_TELEA</span><span class="p">);</span>
    <span class="n">imshow</span><span class="p">(</span><span class="s">"cv_inpaint"</span><span class="p">,</span> <span class="n">imgdst</span><span class="p">);</span>
    <span class="n">imwrite</span><span class="p">(</span><span class="n">output_path</span> <span class="o">+</span> <span class="s">"cv_inpaint.jpg"</span><span class="p">,</span> <span class="n">imgdst</span><span class="p">);</span>
    <span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

:ET